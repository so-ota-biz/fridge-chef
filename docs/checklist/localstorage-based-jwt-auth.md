# ローカルストレージベースJWT認証実装チェックリスト

## 概要
フロントエンドでJWTトークンをローカルストレージに保存し、認証を管理するシステムの実装手順です。

## バックエンド実装

### 1. JWT戦略の設定
- [x] `JwtStrategy`でリクエストヘッダーからトークンを取得するよう設定
- [x] `ExtractJwt.fromAuthHeaderAsBearerToken()`を使用
- [x] JWT_SECRETの環境変数設定

### 2. 認証コントローラー
- [x] `/auth/login` エンドポイントでJWTトークンをレスポンスボディで返却
- [x] `/auth/register` エンドポイントでユーザー登録とトークン発行
- [x] `/auth/profile` エンドポイントで認証済みユーザー情報を取得
- [x] エラーハンドリング（401 Unauthorized等）

### 3. ガード設定
- [x] `@UseGuards(JwtAuthGuard)`で保護されたエンドポイントの設定
- [x] 認証が必要なすべてのAPIエンドポイントにガード適用

## フロントエンド実装

### 1. 認証ストア（Zustand）
- [x] JWTトークンをローカルストレージで管理
- [x] `login`, `logout`, `setUser`アクション実装
- [x] `isAuthenticated`状態管理
- [x] ページリロード時のトークン復元処理

### 2. API Client設定
- [x] Axiosインターセプターでリクエストヘッダーに`Authorization: Bearer {token}`を自動付与
- [x] 401レスポンス時の自動ログアウト処理
- [x] ベースURL設定とエラーハンドリング

### 3. 認証API
- [x] `loginApi`関数でログイン処理
- [x] `registerApi`関数でユーザー登録処理
- [x] `getProfileApi`関数でユーザー情報取得
- [x] レスポンス型定義

### 4. 認証フック
- [x] `useAuth`フックで認証状態管理
- [x] ログイン・ログアウト・登録機能
- [x] エラーハンドリングとローディング状態

### 5. 型定義
- [x] `User`型定義
- [x] `AuthStore`型定義
- [x] `LoginRequest`, `RegisterRequest`型定義
- [x] `AuthResponse`型定義

## セキュリティ考慮事項

### 1. トークン管理
- [x] JWTトークンの適切な有効期限設定
- [x] ローカルストレージからの自動削除（ログアウト時）
- [x] ページリロード時の認証状態復元

### 2. エラーハンドリング
- [x] 401エラー時の自動ログアウト
- [x] ネットワークエラーの適切な処理
- [x] ユーザーフレンドリーなエラーメッセージ

### 3. セキュリティヘッダー
- [x] CORS設定の適切な設定
- [x] Content-Type検証
- [ ] CSRFトークン（将来的な検討事項）

## テスト項目

### 1. 認証フロー
- [x] ユーザー登録機能
- [x] ログイン機能
- [x] ログアウト機能
- [x] 保護されたページへのアクセス制御

### 2. トークン管理
- [x] トークン有効期限切れ時の処理
- [x] ページリロード時の認証状態維持
- [x] 複数タブでの認証状態同期

### 3. エラーケース
- [x] 無効な認証情報でのログイン試行
- [x] トークン改ざん時の処理
- [x] ネットワークエラー時の処理

## 運用考慮事項

### 1. 環境変数
```
JWT_SECRET=your-secret-key
NEXT_PUBLIC_API_URL=http://localhost:3001/api
```

### 2. デプロイ時の注意点
- JWT_SECRETは本番環境で強力なキーを使用
- HTTPS必須（本番環境）
- 適切なCORS設定

### 3. モニタリング
- 認証失敗ログの監視
- 異常なAPIアクセスパターンの検知

## 今後の改善項目
- [ ] リフレッシュトークンの実装
- [ ] トークンのセキュアな保存方法（HttpOnly Cookie等）
- [ ] 多要素認証（MFA）の検討
- [ ] セッション管理の強化