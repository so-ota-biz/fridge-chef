erDiagram
    %% Supabase auth schema (managed by Supabase)
    auth_users ||--|| user_profiles : "references"
    user_profiles ||--o{ user_cooking_records : "has"
    user_profiles ||--o{ user_ingredients : "has"
    user_profiles ||--o{ user_favorites : "has"
    user_profiles ||--o{ api_usage_logs : "has"
    recipes ||--o{ user_cooking_records : "recorded_in"
    recipes ||--o{ recipe_ingredients : "contains"
    recipes ||--o{ recipe_steps : "contains"
    recipes ||--o{ user_favorites : "favorited_in"
    ingredients ||--o{ recipe_ingredients : "used_in"
    ingredients ||--o{ user_ingredients : "selected_by"
    ingredient_categories ||--o{ ingredients : "belongs_to"

    %% Supabase auth.users table (managed by Supabase Auth)
    auth_users {
        uuid id PK "Supabase managed"
        string email "Supabase managed"
        string password_hash "Supabase managed"
        jsonb raw_user_meta_data "Supabase managed"
        jsonb raw_app_meta_data "Supabase managed"
        timestamp created_at "Supabase managed"
        timestamp updated_at "Supabase managed"
        boolean email_confirmed_at "Supabase managed"
    }

    %% Public schema user profiles table
    user_profiles {
        uuid id PK "FK to auth.users"
        string display_name "NULL"
        string first_name "NULL"
        string last_name "NULL"
        string avatar_url "NULL"
        boolean is_premium "DEFAULT false"
        timestamp premium_expires_at "NULL"
        timestamp created_at "NOT NULL"
        timestamp updated_at "NOT NULL"
    }

    ingredient_categories {
        int id PK "auto_increment"
        string name "NOT NULL"
        string icon_url "NULL"
        int sort_order "NOT NULL"
        timestamp created_at "NOT NULL"
    }

    ingredients {
        int id PK "auto_increment"
        string name "NOT NULL"
        int category_id FK "NOT NULL"
        string icon_url "NULL"
        int sort_order "NOT NULL"
        timestamp created_at "NOT NULL"
    }

    recipes {
        int id PK "auto_increment"
        string title "NOT NULL"
        text description "NULL"
        int cooking_time "NOT NULL"
        int difficulty "NOT NULL 1-3"
        int servings "NOT NULL"
        string image_url "NULL Nano Banana generated"
        string genre "NOT NULL"
        int calories "NULL"
        timestamp created_at "NOT NULL"
        timestamp updated_at "NOT NULL"
    }

    recipe_steps {
        int id PK "auto_increment"
        int recipe_id FK "NOT NULL"
        int step_number "NOT NULL"
        text instruction "NOT NULL"
        string image_url "NULL"
        text tips "NULL"
        timestamp created_at "NOT NULL"
    }

    recipe_ingredients {
        int id PK "auto_increment"
        int recipe_id FK "NOT NULL"
        int ingredient_id FK "NOT NULL"
        string amount "NOT NULL"
        boolean is_required "DEFAULT true"
        timestamp created_at "NOT NULL"
    }


    user_cooking_records {
        int id PK "auto_increment"
        uuid user_id FK "NOT NULL references user_profiles(id)"
        int recipe_id FK "NOT NULL"
        string user_image_url "NULL"
        int rating "NULL 1-5"
        text memo "NULL"
        text ai_feedback "NULL"
        timestamp cooked_at "NOT NULL"
        timestamp created_at "NOT NULL"
    }

    user_favorites {
        int id PK "auto_increment"
        uuid user_id FK "NOT NULL references user_profiles(id)"
        int recipe_id FK "NOT NULL"
        timestamp created_at "NOT NULL"
    }

    user_ingredients {
        int id PK "auto_increment"
        uuid user_id FK "NOT NULL references user_profiles(id)"
        int ingredient_id FK "NOT NULL"
        timestamp created_at "NOT NULL"
    }

    api_usage_logs {
        int id PK "auto_increment"
        uuid user_id FK "NOT NULL references user_profiles(id)"
        string api_type "NOT NULL"
        string request_data "NULL"
        string response_data "NULL"
        decimal cost "NOT NULL"
        timestamp created_at "NOT NULL"
    }